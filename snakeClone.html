<!DOCTYPE html>
<html>
<head>
  <!-- Howl is very wrong, Snake is clearly superior. -->
  <meta charset="UTF-8">
  <title>Snake Game for the Blackwings</title>
  <style>
    #board {
      display: grid;
      grid-template-columns: repeat(15, 1fr);
      grid-template-rows: repeat(15, 1fr);
      gap: 1px;
      background-color: #ddd;
      width: calc(50px * 15 + 1px * 14);
    }

    .cell {
      background-color: #fff;
      border: 1px solid #bbb;
      height: 50px;
      width: 50px;
    }

    .snake {
      background-color: #2ecc71;
    }

    .food {
      background-color: #f1c40f;
    }

    #score {
      margin-top: 10px;
      font-size: 18px;
      font-weight: bold;
    }
    #highscore {
      margin-top: 10px;
      font-size: 18px;
      font-weight: bold;
    }
    #startGameBtn {
        width: calc(52px * 15 + 1px * 14);
        height: calc(52px * 15 + 1px * 14);
        position: absolute;
        background-color: rgba(0,0,0,0.5);
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
    }
    #startGameBtn:hover {
        background-color: rgba(0,0,0,0.7);
    }
    #startGameBtn > div {
        position: absolute; 
        top: 50%; 
        left: 50%; 
        transform: translate(-50%, -50%); 
        font-size: 30px; 
        color: white;
    }
  </style>
</head>
<body>
    <div id="startGameBtn">
        <div>Start Game</div>
    </div>
    <div id="board"></div>
    <div id="score"></div>
    <div id="highscore"></div>
    <script>
        //start game when button is clicked
        document.getElementById("startGameBtn").addEventListener("click", () => {
            document.getElementById("startGameBtn").style.display = "none";
            startGame();
        });

        const BOARD_SIZE = 15;
        const INTERVAL = 100;

        let gameState = {
        snake: [
            { x: 7, y: 7 },
            { x: 7, y: 6 },
            { x: 7, y: 5 }
        ],
        direction: "down",
        food: { x: 2, y: 2 },
        score: 0,
        highscore: 0
        };

        document.addEventListener("keydown", event => {
        switch (event.key) {
            case "ArrowUp":
            if (gameState.direction !== "down") {
                gameState.direction = "up";
            }
            break;
            case "ArrowDown":
            if (gameState.direction !== "up") {
                gameState.direction = "down";
            }
            break;
            case "ArrowLeft":
            if (gameState.direction !== "right") {
                gameState.direction = "left";
            }
            break;
            case "ArrowRight":
            if (gameState.direction !== "left") {
                gameState.direction = "right";
            }
            break;
        }
        });

        const startGame = () => {
            //read highscore from local storage
            gameState.highscore = localStorage.getItem("highscore");
            if (gameState.highscore === null) {
                gameState.highscore = 0;
            }
            const highscoreDisplay = document.querySelector("#highscore");
            highscoreDisplay.innerText = `Highscore: ${gameState.highscore}`;

            setInterval(() => {
                const head = gameState.snake[0];
                let newHead;
                switch (gameState.direction) {
                    case "up":
                    newHead = { x: head.x, y: (head.y - 1 + BOARD_SIZE) % BOARD_SIZE };
                    break;
                    case "down":
                    newHead = { x: head.x, y: (head.y + 1) % BOARD_SIZE };
                    break;
                    case "left":
                    newHead = { x: (head.x - 1 + BOARD_SIZE) % BOARD_SIZE, y: head.y };
                    break;
                    case "right":
                    newHead = { x: (head.x + 1) % BOARD_SIZE, y: head.y };
                    break;
                }
                gameState.snake.unshift(newHead);

                // check if the snake has collided with itself
                if (gameState.snake.slice(1).some(segment => segment.x === newHead.x && segment.y === newHead.y)) {
                    //stop the game
                    clearInterval();
                    localStorage.setItem("highscore", gameState.highscore);
                    alert(`Game over! Your score was ${gameState.score}.`);
                    location.reload();
                }

                // check if the snake has eaten the food
                if (newHead.x === gameState.food.x && newHead.y === gameState.food.y) {
                    gameState.food = { x: Math.floor(Math.random() * BOARD_SIZE), y: Math.floor(Math.random() * BOARD_SIZE) };
                    gameState.score += gameState.snake.length;
                    if (gameState.score > gameState.highscore) {
                        gameState.highscore = gameState.score;
                        const highscoreDisplay = document.querySelector("#highscore");
                        highscoreDisplay.innerText = `Highscore: ${gameState.highscore}`;
                    }
                } else {
                    gameState.snake.pop();
                }

                // draw the game board
                const board = document.querySelector("#board");
                board.innerHTML = "";
                for (let y = 0; y < BOARD_SIZE; y++) {
                    for (let x = 0; x < BOARD_SIZE; x++) {
                    const cell = document.createElement("div");
                    cell.classList.add("cell");
                    if (x === gameState.food.x && y === gameState.food.y) {
                        cell.classList.add("food");
                    }
                    if (gameState.snake.some(segment => segment.x === x && segment.y === y)) {
                        cell.classList.add("snake");
                    }
                    board.appendChild(cell);
                    }
                }

                // update the score display
                const scoreDisplay = document.querySelector("#score");
                scoreDisplay.innerText = `Score: ${gameState.score}`;
            }, INTERVAL);
        }
    </script>
	<div class="navigate-back">
		<a href="index.html">Back to index</a>
	</div>
</body>
</html>